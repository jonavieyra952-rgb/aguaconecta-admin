<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Campañas - AguaConecta</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      background-color: #f4f9fb;
      font-family: 'Segoe UI', sans-serif;
    }

    .page-header {
      background-color: #00796b;
      color: white;
      padding: 30px 0;
      border-radius: 0 0 15px 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-align: center;
      margin-bottom: 30px;
    }

    .btn-custom {
      background-color: #00796b;
      color: white;
      font-weight: 500;
    }

    .btn-custom:hover {
      background-color: #005f56;
    }

    .campania-img {
      width: 100px;
      height: auto;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #ccc;
      transition: transform 0.2s ease-in-out;
      cursor: pointer;
    }

    .campania-img:hover {
      transform: scale(1.05);
    }

    .modal-img-zoom {
      transition: transform 0.3s ease;
    }

    .modal.fade .modal-dialog {
      transform: scale(0.95);
      transition: transform 0.3s ease-out;
    }

    .modal.fade.show .modal-dialog {
      transform: scale(1);
    }

    .table thead {
      background-color: #00796b;
      color: white;
    }

    .estado-btn {
      border: none;
      background: none;
      padding: 0;
    }
  </style>
</head>
<body>

  <!-- Encabezado -->
  <div class="container-fluid page-header">
    <h2><i class="bi bi-megaphone-fill me-2"></i>Campañas Informativas</h2>
  </div>

  <div class="container mb-5">

    <!-- Botones -->
    <div class="d-flex justify-content-end mb-3 gap-2">
      <a href="{{ url_for('admin_routes.dashboard_admin') }}" class="btn btn-custom">
        <i class="bi bi-house-door-fill me-1"></i>Volver al Inicio
      </a>
      <a href="{{ url_for('admin_routes.nueva_campania') }}" class="btn btn-success">
        <i class="bi bi-plus-circle-fill me-1"></i>Agregar nueva campaña
      </a>
    </div>

    <!-- Alertas flash con SweetAlert2 -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <script>
          document.addEventListener('DOMContentLoaded', function () {
            {% for category, message in messages %}
              Swal.fire({
                icon: '{{ 'success' if category == 'success' else 'info' }}',
                title: '{{ 'Éxito' if category == 'success' else 'Aviso' }}',
                text: '{{ message }}',
                timer: 3000,
                showConfirmButton: false
              });
            {% endfor %}
          });
        </script>
      {% endif %}
    {% endwith %}

    {% if campanias %}
    <div class="table-responsive shadow-sm rounded">
      <table class="table table-bordered align-middle text-center">
        <thead>
          <tr>
            <th>Título</th>
            <th>Descripción</th>
            <th>Dirección</th>
            <th>Inicio</th>
            <th>Fin</th>
            <th>Estado</th>
            <th>Imagen</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for campania in campanias %}
          <tr>
            <td>{{ campania.titulo }}</td>
            <td>{{ campania.descripcion }}</td>
            <td>{{ campania.direccion }}</td>
            <td>{{ campania.fecha_inicio }}</td>
            <td>{{ campania.fecha_fin }}</td>
            <td>
              <form action="{{ url_for('admin_routes.cambiar_estado_campania', id=campania.id) }}" method="POST">
                <button type="submit" class="estado-btn">
                  <span class="badge bg-{{ 'success' if campania.estado == 'activa' else 'secondary' }}">
                    {{ campania.estado.capitalize() }}
                  </span>
                </button>
              </form>
            </td>
            <td>
              <img src="{{ url_for('static', filename='uploads/campanias/' + campania.imagen) }}"
                   alt="Imagen campaña"
                   class="campania-img"
                   data-bs-toggle="modal"
                   data-bs-target="#modalImagen{{ campania.id }}">
            </td>
            <td>
              <a href="{{ url_for('admin_routes.editar_campania', id=campania.id) }}" class="btn btn-sm btn-primary mb-1">
                <i class="bi bi-pencil-fill"></i> Editar
              </a>
              <form id="form-eliminar-{{ campania.id }}" action="{{ url_for('admin_routes.eliminar_campania', id=campania.id) }}" method="POST" class="d-inline">
                <button type="button" class="btn btn-sm btn-danger" onclick="confirmarEliminar({{ campania.id }})">
                  <i class="bi bi-trash-fill"></i> Eliminar
                </button>
              </form>
            </td>
          </tr>

          <!-- Modal de imagen ampliada -->
          <div class="modal fade" id="modalImagen{{ campania.id }}" tabindex="-1" aria-labelledby="modalLabel{{ campania.id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalLabel{{ campania.id }}">{{ campania.titulo }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body text-center">
                  <img src="{{ url_for('static', filename='uploads/campanias/' + campania.imagen) }}"
                       alt="Imagen campaña ampliada"
                       class="img-fluid rounded modal-img-zoom">
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="alert alert-info text-center">No hay campañas registradas aún.</div>
    {% endif %}
  </div>

  <script>
    function confirmarEliminar(id) {
      Swal.fire({
        title: '¿Eliminar campaña?',
        text: 'Esta acción eliminará la campaña permanentemente.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Sí, eliminar',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          document.getElementById('form-eliminar-' + id).submit();
        }
      });
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
